# =============================================================================
# Minimal Chat Example
# =============================================================================
#
# The simplest possible Visor chat assistant.
# No intent routing, no dynamic tools - just a basic conversation loop.
#
# Usage:
#   visor run examples/minimal-chat.yaml --event manual
#
# =============================================================================

version: "1.0"

checks:
  ask:
    type: human-input
    prompt: |
      Hi! I'm a simple chat assistant. How can I help you?

  answer:
    type: ai
    depends_on: [ask]
    schema:
      type: object
      properties:
        text:
          type: string
      required: [text]
    ai:
      skip_code_context: true
      disableTools: true
    prompt: |
      You are a helpful assistant. Respond to the user's message.

      <history>
      {% assign history = '' | chat_history: 'ask', 'answer' %}
      {% for m in history %}
      {{ m.role | capitalize }}: {{ m.text }}
      {% endfor %}
      </history>

      User: {{ outputs['ask'].text }}

      Be helpful and concise.
    on_success:
      goto: ask

tests:
  defaults:
    strict: true
    ai_provider: mock

  cases:
    - name: basic-chat
      flow:
        - name: chat-flow
          event: manual
          fixture: local.minimal
          routing:
            max_loops: 0
          mocks:
            ask[]:
              - text: "Hello!"
            answer[]:
              - text: "Hello! How can I help you today?"
          expect:
            calls:
              - step: ask
                exactly: 1
              - step: answer
                exactly: 1
